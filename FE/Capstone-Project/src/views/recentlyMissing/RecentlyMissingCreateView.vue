<template>
    <div class="min-h-screen bg-slate-50 pt-16 pb-6 sm:pt-20 sm:pb-8">
        <div class="max-w-4xl mx-auto px-3 sm:px-4">

            <!-- Hero section -->
            <section
                class="bg-white rounded-xl sm:rounded-2xl border border-slate-200/80 shadow-sm px-4 sm:px-5 py-4 sm:py-5 mb-4 sm:mb-5">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                    <div class="flex items-start gap-3">
                        <div
                            class="mt-0.5 h-10 w-10 rounded-xl bg-blue-500/10 text-blue-500 flex items-center justify-center border border-blue-100">
                            <i class="fas fa-user-plus text-base"></i>
                        </div>
                        <div>
                            <h1 class="text-base sm:text-lg font-semibold text-slate-900">
                                ƒêƒÉng b√°o c√°o ng∆∞·ªùi th·∫•t l·∫°c g·∫ßn ƒë√¢y
                            </h1>
                            <p class="mt-1 text-xs sm:text-sm text-slate-600 max-w-xl">
                                ƒêƒÉng th√¥ng tin ng∆∞·ªùi th·∫•t l·∫°c ho·∫∑c ng∆∞·ªùi b·∫°n g·∫∑p ƒë·ªÉ c·ªông ƒë·ªìng v√† h·ªá th·ªëng AI h·ªó tr·ª£ t√¨m
                                ki·∫øm,
                                ƒëo√†n t·ª• gia ƒë√¨nh.
                            </p>
                        </div>
                    </div>
                    <div class="text-xs text-slate-500">
                        <p><span class="font-semibold text-blue-600">L∆∞u √Ω:</span> H√£y nh·∫≠p th√¥ng tin ch√≠nh x√°c v√† ƒë·∫ßy
                            ƒë·ªß.</p>
                    </div>
                </div>
            </section>

            <!-- Profile Type Selection -->
            <section
                class="bg-white rounded-xl sm:rounded-2xl border border-slate-200/80 shadow-sm p-4 sm:p-5 mb-4 sm:mb-5">
                <h2 class="text-sm sm:text-base font-semibold text-slate-900 mb-3 sm:mb-4">
                    Ch·ªçn lo·∫°i b√°o c√°o
                </h2>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <button type="button"
                        class="text-left border rounded-lg p-3 sm:p-4 cursor-pointer transition-all duration-200 hover:shadow-md hover:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-500/30"
                        :class="{ 'border-blue-500 bg-blue-50': profileType === 'seeker' }"
                        @click="profileType = 'seeker'">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-6 h-6 rounded-full border-2"
                                :class="profileType === 'seeker' ? 'border-blue-500 bg-blue-50' : 'border-slate-300'">
                                <div v-if="profileType === 'seeker'" class="w-2.5 h-2.5 bg-blue-500 rounded-full"></div>
                            </div>
                            <div>
                                <h3 class="font-medium text-slate-900 text-sm sm:text-base">Ng∆∞·ªùi ƒëi t√¨m</h3>
                                <p class="text-xs sm:text-[13px] text-slate-600">
                                    T√¥i ƒëang t√¨m ki·∫øm ng∆∞·ªùi th√¢n th·∫•t l·∫°c.
                                </p>
                            </div>
                        </div>
                    </button>

                    <button type="button"
                        class="text-left border rounded-lg p-3 sm:p-4 cursor-pointer transition-all duration-200 hover:shadow-md hover:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-500/30"
                        :class="{ 'border-blue-500 bg-blue-50': profileType === 'finder' }"
                        @click="profileType = 'finder'">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-6 h-6 rounded-full border-2"
                                :class="profileType === 'finder' ? 'border-blue-500 bg-blue-50' : 'border-slate-300'">
                                <div v-if="profileType === 'finder'" class="w-2.5 h-2.5 bg-blue-500 rounded-full"></div>
                            </div>
                            <div>
                                <h3 class="font-medium text-slate-900 text-sm sm:text-base">Ng∆∞·ªùi cung c·∫•p th√¥ng tin
                                </h3>
                                <p class="text-xs sm:text-[13px] text-slate-600">
                                    T√¥i g·∫∑p ng∆∞·ªùi c√≥ th·ªÉ ƒëang th·∫•t l·∫°c.
                                </p>
                            </div>
                        </div>
                    </button>
                </div>
            </section>

            <!-- Profile Form -->
            <section class="bg-white rounded-xl sm:rounded-2xl border border-slate-200/80 shadow-sm p-4 sm:p-5">
                <h2 class="text-sm sm:text-base font-semibold text-slate-900 mb-3 sm:mb-4">
                    Th√¥ng tin b√°o c√°o
                </h2>

                <form @submit.prevent="handleSubmit" class="space-y-4 sm:space-y-5">
                    <!-- Title -->
                    <div>
                        <label for="title" class="block text-xs sm:text-sm font-medium text-slate-700 mb-1.5">
                            Ti√™u ƒë·ªÅ b√°o c√°o <span class="text-red-500">*</span>
                        </label>
                        <input v-model="formData.title" type="text" id="title" required
                            class="w-full border border-slate-300 rounded-lg px-3 sm:px-3.5 py-2.5 text-sm sm:text-[15px] shadow-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 placeholder:text-slate-400"
                            placeholder="Nh·∫≠p ti√™u ƒë·ªÅ ng·∫Øn g·ªçn, d·ªÖ hi·ªÉu..." />
                    </div>

                    <!-- Name -->
                    <div>
                        <label for="name" class="block text-xs sm:text-sm font-medium text-slate-700 mb-1.5">
                            T√™n ng∆∞·ªùi th·∫•t l·∫°c
                            <span v-if="profileType === 'seeker'" class="text-red-500">*</span>
                            <span v-else class="text-slate-400 font-normal">(n·∫øu bi·∫øt)</span>
                        </label>
                        <input v-model="formData.name" type="text" id="name" :required="profileType === 'seeker'"
                            class="w-full border border-slate-300 rounded-lg px-3 sm:px-3.5 py-2.5 text-sm sm:text-[15px] shadow-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 placeholder:text-slate-400"
                            placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß..." />
                    </div>

                    <!-- Age and Missing Date in a grid on larger screens -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- Age -->
                        <div>
                            <label for="age" class="block text-xs sm:text-sm font-medium text-slate-700 mb-1.5">
                                Tu·ªïi
                                <span class="text-slate-400 font-normal">(∆∞·ªõc t√≠nh)</span>
                            </label>
                            <input v-model.number="formData.age" type="number" id="age" min="0" max="120"
                                class="w-full border border-slate-300 rounded-lg px-3 sm:px-3.5 py-2.5 text-sm sm:text-[15px] shadow-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 placeholder:text-slate-400"
                                placeholder="Nh·∫≠p tu·ªïi (n·∫øu bi·∫øt)..." />
                        </div>

                        <!-- Missing Date -->
                        <div>
                            <label for="missing_date"
                                class="block text-xs sm:text-sm font-medium text-slate-700 mb-1.5">
                                {{ profileType === 'seeker' ? 'Ng√†y m·∫•t t√≠ch' : 'Ng√†y g·∫∑p' }}
                            </label>
                            <input v-model="formData.missing_date" type="date" id="missing_date" :max="todayDate"
                                class="w-full border border-slate-300 rounded-lg px-3 sm:px-3.5 py-2.5 text-sm sm:text-[15px] shadow-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500" />
                            <p v-if="dateError" class="mt-1 text-xs sm:text-[13px] text-red-500">{{ dateError }}</p>
                        </div>
                    </div>

                    <!-- Location -->
                    <div>
                        <label for="location" class="block text-xs sm:text-sm font-medium text-slate-700 mb-1.5">
                            {{ profileType === 'seeker' ? 'ƒê·ªãa ƒëi·ªÉm m·∫•t t√≠ch' : 'ƒê·ªãa ƒëi·ªÉm g·∫∑p' }}
                        </label>
                        <input v-model="formData.location" type="text" id="location"
                            class="w-full border border-slate-300 rounded-lg px-3 sm:px-3.5 py-2.5 text-sm sm:text-[15px] shadow-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 placeholder:text-slate-400"
                            placeholder="ƒê·ªãa ƒëi·ªÉm c·ª• th·ªÉ (ƒë∆∞·ªùng, ph∆∞·ªùng/x√£, qu·∫≠n/huy·ªán, t·ªânh/th√†nh)..." />
                    </div>

                    <!-- Contact Persons -->
                    <ContactPersonsForm v-model="formData.contact_persons" class="border-t pt-4 sm:pt-5" />

                    <!-- Description -->
                    <div>
                        <label for="description" class="block text-xs sm:text-sm font-medium text-slate-700 mb-1.5">
                            M√¥ t·∫£ chi ti·∫øt <span class="text-red-500">*</span>
                        </label>
                        <textarea v-model="formData.description" id="description" rows="5" required
                            class="w-full border border-slate-300 rounded-lg px-3 sm:px-3.5 py-2.5 text-sm sm:text-[15px] shadow-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 placeholder:text-slate-400"
                            :placeholder="getDescriptionPlaceholder()"></textarea>
                        <p class="mt-1 text-xs sm:text-[13px] text-slate-500 leading-relaxed">
                            {{
                                profileType === 'seeker'
                                    ? 'M√¥ t·∫£ chi ti·∫øt v·ªÅ ng∆∞·ªùi th√¢n, ho√†n c·∫£nh m·∫•t t√≠ch, ƒë·∫∑c ƒëi·ªÉm nh·∫≠n d·∫°ng, t√¨nh hu·ªëng cu·ªëi c√πng...'
                            : 'M√¥ t·∫£ chi ti·∫øt v·ªÅ ng∆∞·ªùi b·∫°n g·∫∑p, ho√†n c·∫£nh g·∫∑p, ƒë·∫∑c ƒëi·ªÉm nh·∫≠n d·∫°ng, tr·∫°ng th√°i c·ªßa ng∆∞·ªùi ƒë√≥...'
                            }}
                        </p>
                    </div>

                    <!-- Status (optional - auto set to active) -->
                    <input type="hidden" v-model="formData.status" />

                    <!-- Submit Buttons -->
                    <div
                        class="flex flex-col sm:flex-row sm:justify-end gap-2 sm:gap-3 pt-4 sm:pt-5 border-t border-slate-200">
                        <router-link to="/recently-missing"
                            class="px-4 sm:px-5 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors text-center text-sm sm:text-[15px]">
                            <i class="fas fa-times mr-2"></i>
                            H·ªßy
                        </router-link>
                        <button type="submit" :disabled="submitting"
                            class="px-4 sm:px-5 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm sm:text-[15px] font-medium transition-colors shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center">
                            <i class="fas fa-spinner fa-spin mr-2" v-if="submitting"></i>
                            <i class="fas fa-save mr-2" v-else></i>
                            {{ submitting ? 'ƒêang t·∫°o...' : 'T·∫°o b√°o c√°o' }}
                        </button>
                    </div>
                </form>
            </section>

            <!-- Help text -->
            <section class="mt-4 sm:mt-5 bg-blue-50 border border-blue-200 rounded-xl px-3.5 sm:px-4 py-3 sm:py-3.5">
                <div class="flex items-start gap-2.5">
                    <i class="fas fa-info-circle text-blue-500 mt-0.5 text-base sm:text-lg"></i>
                    <div class="text-xs sm:text-[13px] text-blue-900">
                        <h4 class="font-semibold mb-1 sm:mb-1.5">L∆∞u √Ω quan tr·ªçng</h4>
                        <ul class="space-y-1 list-disc list-inside">
                            <li>Sau khi t·∫°o b√°o c√°o, b·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn trang t·∫£i ·∫£nh khu√¥n m·∫∑t.</li>
                            <li>·∫¢nh r√µ n√©t gi√∫p h·ªá th·ªëng AI nh·∫≠n di·ªán v√† kh·ªõp v·ªõi c√°c b√°o c√°o kh√°c ch√≠nh x√°c h∆°n.</li>
                            <li>Th√¥ng tin li√™n h·ªá gi√∫p c√°c b√™n c√≥ th√¥ng tin h·ªØu √≠ch k·∫øt n·ªëi v·ªõi b·∫°n nhanh ch√≥ng.</li>
                            <li>M√¥ t·∫£ chi ti·∫øt, r√µ r√†ng s·∫Ω tƒÉng kh·∫£ nƒÉng t√¨m ki·∫øm hi·ªáu qu·∫£.</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Long-term Missing Warning Modal -->
    <div v-if="showLongTermWarning"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-lg w-full p-4 sm:p-6 mx-auto">
            <div class="flex items-center justify-between mb-3 sm:mb-4">
                <h3 class="text-lg sm:text-xl font-bold text-gray-800">
                    <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                    C·∫£nh b√°o: Th·∫•t l·∫°c l√¢u nƒÉm
                </h3>
                <button @click="showLongTermWarning = false" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="mb-4 sm:mb-6">
                <p class="text-sm sm:text-base text-gray-700 mb-3 sm:mb-4">
                    B·∫°n ƒë√£ nh·∫≠p th·ªùi gian m·∫•t t√≠ch t·ª´ <span class="font-semibold">5 nƒÉm tr·ªü l√™n</span>. Trong kho·∫£ng
                    th·ªùi gian d√†i nh∆∞ v·∫≠y, khu√¥n m·∫∑t c·ªßa ng∆∞·ªùi th·∫•t l·∫°c c√≥ th·ªÉ ƒë√£ thay ƒë·ªïi ƒë√°ng k·ªÉ.
                </p>
                <p class="text-sm sm:text-base text-gray-700 mb-3 sm:mb-4">
                    ƒêi·ªÅu n√†y c√≥ th·ªÉ l√†m gi·∫£m ƒë·ªô ch√≠nh x√°c c·ªßa h·ªá th·ªëng nh·∫≠n d·∫°ng khu√¥n m·∫∑t AI khi t√¨m ki·∫øm ng∆∞·ªùi
                    th·∫•t l·∫°c.
                </p>
                <div class="bg-blue-50 border-l-4 border-blue-500 p-3 sm:p-4 mb-3 sm:mb-4">
                    <p class="text-sm sm:text-base text-blue-700">
                        <strong>G·ª£i √Ω:</strong> ƒê·ªëi v·ªõi tr∆∞·ªùng h·ª£p th·∫•t l·∫°c l√¢u nƒÉm, b·∫°n c√≥ th·ªÉ t·∫°o h·ªì s∆° th·∫•t l·∫°c
                        l√¢u nƒÉm ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ t·ªët h∆°n.
                    </p>
                    <router-link to="/profile/create"
                        class="text-sm sm:text-base text-blue-600 hover:underline mt-1 sm:mt-2 inline-block">
                        <i class="fas fa-arrow-right mr-1"></i> T·∫°o h·ªì s∆° th·∫•t l·∫°c l√¢u nƒÉm
                    </router-link>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row sm:justify-end space-y-2 sm:space-y-0 sm:space-x-3">
                <button @click="showLongTermWarning = false"
                    class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 text-sm sm:text-base">
                    Quay l·∫°i ch·ªânh s·ª≠a
                </button>
                <button @click="proceedWithLongTermMissing"
                    class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 text-sm sm:text-base">
                    V·∫´n ti·∫øp t·ª•c t·∫°o b√°o c√°o
                </button>
            </div>
        </div>
    </div>
    
</template>

<script>
import { ref, watch, computed } from 'vue';
import { useRouter } from 'vue-router';
import { useStore } from 'vuex';
import ContactPersonsForm from '@/components/recentlyMissing/forms/ContactPersonsForm.vue';

export default {
    name: 'RecentlyMissingCreateView',

    components: {
        ContactPersonsForm
    },

    setup() {
        const router = useRouter();
        const store = useStore();

        // State
        const profileType = ref('seeker');
        const submitting = ref(false);
        const dateError = ref('');
        const showLongTermWarning = ref(false);
        const formData = ref({
            title: '',
            name: '',
            age: null,
            missing_date: '',
            location: '',
            description: '',
            contact_persons: {},
            profile_type: 'seeker',
            status: 'active'
        });

        // Get today's date in YYYY-MM-DD format for max date validation
        const todayDate = computed(() => {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        });

        // Update form data when profile type changes
        watch(profileType, (newType) => {
            formData.value.profile_type = newType;
        });

        // Check if the missing date is more than 5 years ago
        const isLongTermMissing = () => {
            if (!formData.value.missing_date || profileType.value !== 'seeker') return false;

            const missingDate = new Date(formData.value.missing_date);
            const today = new Date();

            // Calculate difference in years
            const diffTime = today - missingDate;
            const diffYears = diffTime / (1000 * 60 * 60 * 24 * 365.25);

            return diffYears >= 5;
        };

        // Dynamic placeholder for description
        const getDescriptionPlaceholder = () => {
            if (profileType.value === 'seeker') {
                return 'V√≠ d·ª•: Ng∆∞·ªùi th√¢n t√¥i cao kho·∫£ng 1m65, t√≥c ng·∫Øn m√†u ƒëen, c√≥ n·ªët ru·ªìi ·ªü m√° tr√°i. L·∫ßn cu·ªëi g·∫∑p ƒëang m·∫∑c √°o s∆° mi tr·∫Øng v√† qu·∫ßn jeans xanh. Ng∆∞·ªùi n√†y c√≥ th√≥i quen ƒëi d·∫°o bu·ªïi s√°ng v√† th∆∞·ªùng mang theo t√∫i x√°ch nh·ªè m√†u n√¢u...';
            } else {
                return 'V√≠ d·ª•: T√¥i g·∫∑p m·ªôt ng∆∞·ªùi c√≥ v·∫ª ƒëang l·∫°c ƒë∆∞·ªùng, cao kho·∫£ng 1m60, t√≥c b·∫°c, m·∫∑c √°o len ƒë·ªè v√† qu·∫ßn ƒëen. Ng∆∞·ªùi n√†y c√≥ v·∫ª b·ªëi r·ªëi, kh√¥ng nh·ªõ ƒë∆∞·ª£c ƒë·ªãa ch·ªâ nh√† v√† c·ª© h·ªèi ƒëi v·ªÅ ph√≠a B·ªánh vi·ªán Bach Mai. T√¥i g·∫∑p v√†o kho·∫£ng 14h ng√†y h√¥m qua...';
            }
        };

        // Validate form data
        const validateFormData = () => {
            dateError.value = '';

            if (!formData.value.title?.trim()) {
                throw new Error('Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ b√°o c√°o');
            }

            if (!formData.value.description?.trim()) {
                throw new Error('Vui l√≤ng nh·∫≠p m√¥ t·∫£ chi ti·∫øt');
            }

            if (profileType.value === 'seeker' && !formData.value.name?.trim()) {
                throw new Error('Vui l√≤ng nh·∫≠p t√™n ng∆∞·ªùi th·∫•t l·∫°c');
            }

            if (formData.value.age !== null && formData.value.age !== undefined) {
                if (formData.value.age < 0 || formData.value.age > 120) {
                    throw new Error('Tu·ªïi ph·∫£i t·ª´ 0 ƒë·∫øn 120');
                }
            }

            // Validate missing date is not in the future
            if (formData.value.missing_date) {
                const missingDate = new Date(formData.value.missing_date);
                const today = new Date();
                // ƒê·∫∑t c·∫£ hai v·ªÅ 00:00:00 ƒë·ªÉ ch·ªâ so s√°nh ng√†y
                missingDate.setHours(0, 0, 0, 0);
                today.setHours(0, 0, 0, 0);

                if (missingDate > today) {
                    dateError.value = 'Ng√†y kh√¥ng th·ªÉ l√† ng√†y trong t∆∞∆°ng lai';
                    throw new Error('Ng√†y kh√¥ng th·ªÉ l√† ng√†y trong t∆∞∆°ng lai');
                }
            }

            if (formData.value.contact_persons && typeof formData.value.contact_persons === 'object') {
                for (const [relationship, name] of Object.entries(formData.value.contact_persons)) {
                    if (relationship?.length > 50) {
                        throw new Error(`T√™n m·ªëi quan h·ªá "${relationship}" qu√° d√†i (t·ªëi ƒëa 50 k√Ω t·ª±)`);
                    }
                    if (name?.length > 100) {
                        throw new Error(`T√™n ng∆∞·ªùi th√¢n "${name}" qu√° d√†i (t·ªëi ƒëa 100 k√Ω t·ª±)`);
                    }
                }
            }
        };

        // Show notification helper
        const showNotification = (message, type = 'success') => {
            if (type === 'success') {
                console.log('‚úÖ Success:', message);
                alert(`‚úÖ ${message}`);
            } else {
                console.error('‚ùå Error:', message);
                alert(`‚ùå ${message}`);
            }
        };

        // Handle form submission
        const handleSubmit = async () => {
            try {
                validateFormData();

                // Check if it's a long-term missing case
                if (isLongTermMissing()) {
                    showLongTermWarning.value = true;
                    return;
                }

                // If not long-term missing, proceed with normal flow
                await createMissingReport();

            } catch (err) {
                let errorMessage = err.message || 'ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω bi·ªÉu m·∫´u';
                showNotification(errorMessage, 'error');
            }
        };

        // Proceed with creating report even for long-term missing
        const proceedWithLongTermMissing = async () => {
            showLongTermWarning.value = false;
            await createMissingReport();
        };

        // Create missing report
        const createMissingReport = async () => {
            submitting.value = true;

            try {
                const cleanedData = {
                    ...formData.value,
                    title: formData.value.title?.trim(),
                    name: formData.value.name?.trim() || '',
                    location: formData.value.location?.trim() || '',
                    description: formData.value.description?.trim(),
                    contact_persons: formData.value.contact_persons || {},
                    missing_date: formData.value.missing_date || null,
                    age: formData.value.age || null
                };

                console.log('üöÄ Creating missing report with data:', cleanedData);

                const newReport = await store.dispatch('recentlyMissing/createMissingReport', cleanedData);

                console.log('‚úÖ Missing report created successfully:', newReport);

                if (!newReport || !newReport.id) {
                    throw new Error('Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ID b√°o c√°o t·ª´ server');
                }

                showNotification('T·∫°o b√°o c√°o th√†nh c√¥ng! B√¢y gi·ªù h√£y t·∫£i l√™n ·∫£nh khu√¥n m·∫∑t.');

                router.push(`/recently-missing/${newReport.id}/upload-image`);

            } catch (err) {
                console.error('‚ùå Error creating missing report:', err);

                let errorMessage = 'Kh√¥ng th·ªÉ t·∫°o b√°o c√°o. Vui l√≤ng th·ª≠ l·∫°i sau.';

                if (err.response?.data?.detail) {
                    errorMessage = err.response.data.detail;
                } else if (err.response?.data?.error) {
                    errorMessage = err.response.data.error;
                } else if (err.message) {
                    errorMessage = err.message;
                }

                showNotification(errorMessage, 'error');
            } finally {
                submitting.value = false;
            }
        };

        return {
            profileType,
            formData,
            submitting,
            dateError,
            todayDate,
            showLongTermWarning,
            handleSubmit,
            createProfile: createMissingReport, // Alias ƒë·ªÉ kh√¥ng ph·∫£i ƒë·ªïi template
            getDescriptionPlaceholder,
            proceedWithLongTermMissing
        };
    }
}
</script>

<style scoped>
/* Custom styles for better form appearance */
.form-section {
    border-left: 4px solid #e5e7eb;
    padding-left: 1rem;
}

.form-section.active {
    border-left-color: #3b82f6;
    background-color: #f8fafc;
}

/* Smooth transitions */
.transition-all {
    transition-property: all;
    transition-duration: 150ms;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* Focus states */
input:focus,
textarea:focus,
select:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Custom radio button styling */
.radio-option {
    position: relative;
    cursor: pointer;
}

.radio-option input[type="radio"] {
    position: absolute;
    opacity: 0;
}

.radio-option .radio-circle {
    transition: all 0.2s ease;
}

.radio-option input[type="radio"]:checked+.radio-circle {
    border-color: #3b82f6;
    background-color: #3b82f6;
}

/* Fix date input appearance on mobile */
input[type="date"] {
    -webkit-appearance: none;
    appearance: none;
}

/* Fix button alignment on mobile */
@media (max-width: 640px) {

    .flex-col button,
    .flex-col a {
        width: 100%;
    }
}

/* Improve touch targets on mobile */
@media (max-width: 640px) {

    input,
    select,
    textarea,
    button {
        min-height: 44px;
    }
}
</style>